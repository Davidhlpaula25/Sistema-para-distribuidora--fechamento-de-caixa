<div class="fechamento-container">
  <header class="header">
    <h1>ğŸ’° Fechamento de Caixa</h1>
    <button class="btn-secondary" (click)="irParaRelatorios()">
      ğŸ“Š Ver RelatÃ³rios
    </button>
  </header>

  @if (mensagemSucesso()) {
    <div class="mensagem-sucesso">
      {{ mensagemSucesso() }}
    </div>
  }

  <!-- SeleÃ§Ã£o de Data -->
  <section class="card card-data">
    <div class="campo-data">
      <label for="dataFechamento">
        ğŸ“… Data do Fechamento
        <span class="data-info">(Selecione a data que estÃ¡ fechando o caixa)</span>
      </label>
      <input
        id="dataFechamento"
        type="date"
        [value]="dataFechamento()"
        (change)="dataFechamento.set($any($event.target).value)"
        class="input-data-fechamento"
        [max]="obterDataHoje()"
      />
    </div>
  </section>

  <div class="content-grid">
    <!-- SeÃ§Ã£o de Contagem de Dinheiro -->
    <section class="card card-dinheiro">
      <h2>ğŸ’µ Contagem de Dinheiro</h2>
      
      <!-- Moedas -->
      <div class="subsecao">
        <h3>ğŸª™ Moedas</h3>
        <div class="denominacoes-grid">
          @for (item of denominacoes(); track item.valor; let i = $index) {
            @if (item.tipo === 'moeda') {
              <div class="denominacao-item">
                <label class="denominacao-label">
                  {{ formatarMoeda(item.valor) }}
                </label>
                <input
                  type="number"
                  min="0"
                  [value]="item.quantidade"
                  (input)="atualizarQuantidade(i, +$any($event.target).value)"
                  class="input-quantidade"
                  placeholder="Qtd"
                />
                <span class="subtotal">
                  {{ formatarMoeda(calcularSubtotal(item)) }}
                </span>
              </div>
            }
          }
        </div>
      </div>

      <!-- CÃ©dulas -->
      <div class="subsecao">
        <h3>ğŸ’µ CÃ©dulas</h3>
        <div class="denominacoes-grid">
          @for (item of denominacoes(); track item.valor; let i = $index) {
            @if (item.tipo === 'cedula') {
              <div class="denominacao-item">
                <label class="denominacao-label">
                  {{ formatarMoeda(item.valor) }}
                </label>
                <input
                  type="number"
                  min="0"
                  [value]="item.quantidade"
                  (input)="atualizarQuantidade(i, +$any($event.target).value)"
                  class="input-quantidade"
                  placeholder="Qtd"
                />
                <span class="subtotal">
                  {{ formatarMoeda(calcularSubtotal(item)) }}
                </span>
              </div>
            }
          }
        </div>
      </div>

      <div class="total-dinheiro">
        <span>Total em Dinheiro:</span>
        <strong>{{ formatarMoeda(totalDinheiro()) }}</strong>
      </div>
    </section>

    <!-- SeÃ§Ã£o de Outras Formas de Pagamento -->
    <section class="card card-pagamentos">
      <h2>ğŸ’³ Outras Formas de Pagamento</h2>

      <div class="campo-pagamento">
        <label for="cartao">ğŸ’³ CartÃ£o de CrÃ©dito/DÃ©bito</label>
        <input
          id="cartao"
          type="number"
          min="0"
          step="0.01"
          [value]="totalCartao()"
          (input)="totalCartao.set(+$any($event.target).value || 0)"
          class="input-valor"
          placeholder="R$ 0,00"
        />
      </div>

      <div class="campo-pagamento">
        <label for="pix">ğŸ“± PIX</label>
        <input
          id="pix"
          type="number"
          min="0"
          step="0.01"
          [value]="totalPix()"
          (input)="totalPix.set(+$any($event.target).value || 0)"
          class="input-valor"
          placeholder="R$ 0,00"
        />
      </div>

      <div class="campo-pagamento">
        <label for="sangria">ğŸ’¸ Sangria (Despesas)</label>
        <input
          id="sangria"
          type="number"
          min="0"
          step="0.01"
          [value]="sangria()"
          (input)="sangria.set(+$any($event.target).value || 0)"
          class="input-valor"
          placeholder="R$ 0,00"
        />
      </div>

      <div class="resumo-pagamentos">
        <div class="resumo-item">
          <span>ğŸ’µ Dinheiro:</span>
          <span>{{ formatarMoeda(totalDinheiro()) }}</span>
        </div>
        <div class="resumo-item">
          <span>ğŸ’³ CartÃ£o:</span>
          <span>{{ formatarMoeda(totalCartao()) }}</span>
        </div>
        <div class="resumo-item">
          <span>ğŸ“± PIX:</span>
          <span>{{ formatarMoeda(totalPix()) }}</span>
        </div>
        <div class="resumo-item sangria-item">
          <span>ğŸ’¸ Sangria:</span>
          <span>- {{ formatarMoeda(sangria()) }}</span>
        </div>
      </div>
    </section>
  </div>

  <!-- Total Geral Destacado -->
  <div class="total-geral-card">
    <div class="total-geral-content">
      <span class="total-geral-label">TOTAL GERAL</span>
      <span class="total-geral-valor">{{ formatarMoeda(totalGeral()) }}</span>
    </div>
  </div>

  <!-- BotÃµes de AÃ§Ã£o -->
  <div class="acoes">
    <button 
      class="btn-primary btn-fechar" 
      (click)="fecharCaixa()"
      [disabled]="salvando()"
    >
      @if (salvando()) {
        â³ Salvando...
      } @else {
        âœ… Fechar Caixa
      }
    </button>
    <button class="btn-secondary" (click)="resetarFormulario()">
      ğŸ”„ Limpar
    </button>
  </div>
</div>
